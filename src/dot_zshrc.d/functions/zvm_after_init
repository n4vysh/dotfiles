bindkey '^p' history-substring-search-up
bindkey '^n' history-substring-search-down

bindkey -M main "^i" down-line-or-select
bindkey -M menuselect "^i" forward-char

bindkey -r '^s'

source <(fzf --zsh)
bindkey -r '^r'

export ATUIN_NOBIND="true"
eval "$(atuin init zsh --disable-up-arrow)"

zvm_define_widget atuin-search-viins-wrapper
zvm_bindkey viins '^r' atuin-search-viins-wrapper

# NOTE: clipboard integration
# https://github.com/jeffreytse/zsh-vi-mode/issues/19
if [[ -n WAYLAND_DISPLAY ]]; then
	for f in \
		zvm_backward_kill_region \
		zvm_yank \
		zvm_replace_selection \
		zvm_change_surround_text_object \
		zvm_vi_delete \
		zvm_vi_change \
		zvm_vi_change_eol; do
		eval "$(echo "_$f() {"; declare -f $f | tail -n +2)"
		eval "$f() { _$f; echo -en \$CUTBUFFER | wl-copy -n }"
	done

	for f in zvm_vi_put_after zvm_vi_put_before; do
		eval "$(echo "_$f() {"; declare -f $f | tail -n +2)"
		eval "$f() { CUTBUFFER=\$(wl-paste); _$f; zvm_highlight clear }"
	done
fi

zvm_bindkey vicmd 'gl' vi-end-of-line
zvm_bindkey vicmd 'gh' vi-digit-or-beginning-of-line
zvm_bindkey vicmd 'ge' vi-fetch-history

zvm_define_widget opencode-widget
zvm_bindkey viins '^oa' opencode-widget

zvm_define_widget bluetuith-widget
zvm_bindkey viins '^ob' bluetuith-widget

zvm_define_widget lazydocker-widget
zvm_bindkey viins '^oc' lazydocker-widget

zvm_define_widget dbui-widget
zvm_bindkey viins '^od' dbui-widget

zvm_define_widget nvim-widget
zvm_bindkey viins '^oe' nvim-widget

zvm_define_widget y-widget
zvm_bindkey viins '^of' y-widget

zvm_define_widget k9s-widget
zvm_bindkey viins '^ok' k9s-widget

zvm_define_widget btop-widget
zvm_bindkey viins '^om' btop-widget

zvm_define_widget ncspot-widget
zvm_bindkey viins '^o^m' ncspot-widget

zvm_define_widget note-widget
zvm_bindkey viins '^on' note-widget

zvm_define_widget tasks-widget
zvm_bindkey viins '^ot' tasks-widget

zvm_define_widget lg-widget
zvm_bindkey viins '^ov' lg-widget

zvm_define_widget gh-dash-widget
zvm_bindkey viins '^o^v' gh-dash-widget

zvm_define_widget zi-widget
zvm_bindkey viins '^oz' zi-widget

zvm_define_widget home-dir-widget
zvm_bindkey viins '^x^h' home-dir-widget

zvm_define_widget prev-dir-widget
zvm_bindkey viins '^x^p' prev-dir-widget

zvm_define_widget repo-root-dir-widget
zvm_bindkey viins '^x^r' repo-root-dir-widget

zvm_define_widget reload-widget
zvm_bindkey viins '^x^s' reload-widget

# fish-like keybinds
zmodload zsh/complist
bindkey -M menuselect '^n' down-line-or-history
bindkey -M menuselect '^p' up-line-or-history
bindkey -M menuselect '^f' forward-char
bindkey -M menuselect '^b' backward-char

zle -N add-less-pipe-widget
bindkey "^[p" add-less-pipe-widget

zle -N add-sudo-widget
bindkey "^[s" add-sudo-widget

# bash-like keybinds
autoload -Uz edit-command-line
zle -N edit-command-line
bindkey '^x^e' edit-command-line
bindkey '^u' backward-kill-line

# emacs-like keybinds
bindkey '^d' delete-char-or-list
