# XDG
export XDG_CONFIG_HOME=${XDG_CONFIG_HOME:=~/.config}
export XDG_CACHE_HOME=${XDG_CACHE_HOME:=~/.cache}
export XDG_DATA_HOME=${XDG_DATA_HOME:=~/.local/share}
export XDG_STATE_HOME=${XDG_STATE_HOME:=~/.local/state}

# base
export PAGER=less
export EDITOR=nvim
export CZ_EDITOR='cz-editor'
export BROWSER=firefox
export DIFFPROG='nvim -d'
export PNPM_HOME="$XDG_DATA_HOME/pnpm"
export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/gcr/ssh"
if type vivid >/dev/null 2>&1; then
	export LS_COLORS="$(vivid generate tokyonight-night)"
fi
if [[ -n $WAYLAND_DISPLAY ]]; then
	eval $(gnome-keyring-daemon --start 2>/dev/null)
	export SSH_AUTH_SOCK
fi
if type tty gpg-connect-agent >/dev/null 2>&1; then
	export GPG_TTY="$TTY"
	gpg-connect-agent updatestartuptty /bye >/dev/null
fi

# zsh
export HISTFILE=~/.zsh_history
export HISTSIZE=10000
export SAVEHIST=10000
export WORDCHARS="${WORDCHARS/\//}"
export ABBR_GET_AVAILABLE_ABBREVIATION=1
export ABBR_LOG_AVAILABLE_ABBREVIATION=1
export ABBR_LOG_AVAILABLE_ABBREVIATION_AFTER=1
zle_highlight=('paste:none')

fpath=(~/.zshrc.d/functions $fpath)
autoload -Uz ~/.zshrc.d/functions/*(.:t)

## color
local foreground='#c0caf5'
local selection='#283457'
local comment='#565f89'
local red='#f7768e'
local orange='#ff9e64'
local yellow='#e0af68'
local green='#9ece6a'
local purple='#9d7cd8'
local cyan='#7dcfff'
local pink='#bb9af7'

### history
export HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_FOUND="fg=${green},bold"
export HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_NOT_FOUND="fg=${red},bold"

### syntax
typeset -gA FAST_HIGHLIGHT_STYLES
FAST_HIGHLIGHT_STYLES[default]="fg=${foreground}"
FAST_HIGHLIGHT_STYLES[command]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[builtin]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[alias]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[function]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[command-substitution]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[command-substitution-delimiter]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[process-substitution]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[process-substitution-delimiter]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[single-quoted-argument]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[double-quoted-argument]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[dollar-quoted-argument]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[back-quoted-argument]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[back-quoted-argument-delimiter]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[redirection]="fg=${foreground}"
FAST_HIGHLIGHT_STYLES[comment]="fg=${comment}"
FAST_HIGHLIGHT_STYLES[variable]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[brackets]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[bracket-level-1]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[bracket-level-2]="fg=${green}"
FAST_HIGHLIGHT_STYLES[bracket-level-3]="fg=${yellow}"
FAST_HIGHLIGHT_STYLES[glob]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[history-expansion]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[commandseparator]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[unknown-token]="fg=${red}"
FAST_HIGHLIGHT_STYLES[reserved-word]="fg=${pink}"
FAST_HIGHLIGHT_STYLES[precommand]="fg=${green}"
FAST_HIGHLIGHT_STYLES[paths]="fg=${foreground}"
FAST_HIGHLIGHT_STYLES[paired-bracket]="bg=${selection}"
FAST_HIGHLIGHT_STYLES[assign]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[assign-array-bracket]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[directory-pointer]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[path-to-dir]="fg=${cyan},underline"
FAST_HIGHLIGHT_STYLES[path]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[mathvar]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[mathnum]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[matherr]="fg=${red}"
FAST_HIGHLIGHT_STYLES[assign-array-bracket]="fg=${cyan}"
FAST_HIGHLIGHT_STYLES[for-loop-variable]="fg=${purple}"
FAST_HIGHLIGHT_STYLES[for-loop-number]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[for-loop-operator]="fg=${orange}"
FAST_HIGHLIGHT_STYLES[for-loop-separator]="fg=${orange}"

### completion
zstyle ':completion:*' format "%F{${cyan}}%B❯ %d%b%f"
zstyle ':completion:*:descriptions' format "%F{${comment}}%d%f"
zstyle ':completion:*:messages' format "%F{${cyan}}%d%f"
zstyle ':completion:*:corrections' format "%F{${yellow}}%B❯ %d (typo: %e)%b%f"
zstyle ':completion:*:descriptions' format "%F{${yellow}}%B❯ %d%b%f"
zstyle ':completion:*:messages' format "%F{${purple}}%B❯ %d%b%f"
zstyle ':completion:*:warnings' format "%F{${red}}%B no matches found%b%f"

# path
typeset -U path PATH
path=(
	# NOTE: add shims to PATH before mise activate for GUI applications
	#       https://mise.jdx.dev/dev-tools/shims.html
	$XDG_DATA_HOME/mise/shims(N-/)

	$HOME/.local/bin(N-/)
	$HOME/.krew/bin(N-/)
	$PNPM_HOME(N-/)

	$path
)

# Programming
export GOPATH="$HOME/.local"
export CARGO_NET_GIT_FETCH_WITH_CLI=true

# Less
export LESS='-ciMR'
export GROFF_NO_SGR=1 # use legacy format for $LESS_TERMCAP_*
export LESS_TERMCAP_mb=$'\e[1;31m'
export LESS_TERMCAP_md=$'\e[1;38;05;75m'
export LESS_TERMCAP_me=$'\e[0m'
export LESS_TERMCAP_se=$'\e[0m'
export LESS_TERMCAP_so=$'\e[1;44m'
export LESS_TERMCAP_ue=$'\e[0m'
export LESS_TERMCAP_us=$'\e[1;36m'

# fzf
export FZF_DEFAULT_COMMAND='fd --type file --follow --hidden --exclude .git'
export FZF_DEFAULT_OPTS="
	--ansi
	--exit-0
	--extended
	--cycle
	--multi
	--height 40%
	--reverse
	--prompt='▶ '
	--info=inline-right
	--color hl:27,bg+:21,hl+:75
	--color info:69,prompt:75,spinner:69,pointer:69,marker:69,scrollbar:75
"

# Terraform
export TF_CLI_ARGS_plan="-parallelism=30"
export TF_CLI_ARGS_apply="-parallelism=30"

# aws
export AWS_CLI_AUTO_PROMPT=on-partial

# aws-vault
export AWS_VAULT_BACKEND=pass
export AWS_VAULT_PASS_CMD=gopass
export AWS_VAULT_PASS_PREFIX=aws-vault

# john
# https://github.com/open-mpi/hwloc/issues/354
export HWLOC_HIDE_ERRORS=2
# https://github.com/openwall/john/issues/4765
export OMPI_MCA_opal_warn_on_missing_libcuda=0

# kubectx
# NOTE: set kubeconfig per shell session
# https://github.com/ahmetb/kubectx/issues/12#issuecomment-557852519
if [[ -f ~/.kube/config ]]; then
	file="$(mktemp -t "kubectx.XXXXXX")"
	cat ~/.kube/config >|"$file"
	export KUBECONFIG="$file"
fi

# local
[[ -f ~/.zshenv.local ]] && source ~/.zshenv.local

# HACK: modeline for GitHub
# -*- mode: zsh; -*-
